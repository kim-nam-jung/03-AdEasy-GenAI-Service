# config.yaml
app:
  name: "ADEASY_SHORTS"
  version: "v2.5"  # ← 업데이트
  timezone: "Asia/Seoul"

paths:
  repo_root: null
  data_dir: "data"
  inputs_dir: "data/inputs"
  temp_dir: "data/temp"
  outputs_dir: "outputs"
  models_dir: "models"
  bgm_dir: "data/bgm"
  fonts_dir: "assets/fonts"

models:
  cache_dir: "/home/spai0437/cache/hf"
  
  # Step 1: Segmentation (SAM 2)
  sam2:
    repo_id: "facebook/sam2-hiera-large"
    local_dir: "models/sam2"
    device: "cuda"
    dtype: "bfloat16"
  
  # Step 2: Video Generation (LTX-Video 2 Pro)
  ltx_video:
    repo_id: "/app/models/ltx2"
    local_dir: "models/ltx2"
    device: "cuda"
    use_fp8: true
  
  # Step 3: Post-processing
  rife:
    repo_id: "zylucky/RIFE" # Example repository that might have it, or we'll download specific weights
    local_dir: "models/rife"
    version: "4.26"
    device: "cuda"
  
  esrgan: # For Real-CUGAN/Upscaling
    repo_id: "bilibili/ailab-models" # Placeholder
    local_dir: "models/real-cugan"
    device: "cuda"
    scale: 2
    model_name: "pro"

# Step 5 영상 설정 ← 업데이트
video:
  resolution:
    width: 1080
    height: 1920
  fps: 24
  
  # Step 5 출력 (Scene별 raw 영상)
  scene_duration: 2.0  # ← 각 Scene 길이 (초)
  total_scenes: 3
  
  # Step 6 후처리 후 최종 영상
  final_duration: 6.0  # ← 2.0 × 3 = 6초 (전환 효과 제외)
  
  # Scene 구성 (Step 2 AdPlan 기준)
  scenes:
    count: 3
    durations_sec: [2.0, 2.0, 2.0]  # ← 업데이트 (5.5, 5.0, 5.0 → 2.0, 2.0, 2.0)
    frame_counts: [48, 48, 48]      # ← 업데이트 (24fps × 2.0s)
  
  # 전환 효과
  transitions:
    type: "dissolve"
    duration_sec: 0.5
    overlap_frames: 12
  
  # 인코딩
  encode:
    vcodec: "libx264"
    acodec: "aac"
    crf: 18
    preset: "medium"
    pix_fmt: "yuv420p"
    audio_bitrate: "192k"

# Step 4 키프레임 설정
keyframe:
  size: [704, 1280]
  controlnet_scale: 0.8
  negative_prompt_default: "blurry, low quality, distorted, ugly, watermark, text, deformed, extra limbs"

# Step 6 후처리 설정
postprocess:
  rife:
    enabled: true
    target_fps: 24
    apply_if_fps_below: 24
  
  esrgan:
    enabled: true
    scale: 2  # 704×1280 → 1408×2560
  
  ffmpeg_scale_crop:
    enabled: true
    scale:
      width: 1080
      height: 1920
      force_original_aspect_ratio: "increase"
    crop:
      width: 1080
      height: 1920

# VRAM 관리
vram:
  gate1:
    free_gb_required: 8
    cleanup_target_gb: 2
  gate2:
    free_gb_required: 8
    cleanup_target_gb: 2
  safety_margin_gb: 2
  
  # Step별 예상 VRAM 사용량 (참고)
  expected_usage:
    step0_fastsam: 2
    step1_qwen_vl: 4
    step1_5_qwen_llm: 8
    step2_qwen_llm: 8
    step3_controlnet: 2
    step4_sdxl: 9
    step5_ltx_video_load: 0  # CPU Offload
    step5_ltx_video_generate: 15  # duration=2.0 기준
    step6_esrgan: 4

# Step 9 품질 검증
quality:
  identity_score_threshold: 0.90
  ssim:
    sample_every_n_frames: 24
    top_percent: 50

# Redis
redis:
  url_env: "REDIS_URL"
  default_url: "redis://localhost:6379/0"
  key_prefix: "task:"
  ttl_seconds: 86400

# Celery
celery:
  broker_url: "redis://localhost:6379/0"
  result_backend: "redis://localhost:6379/0"
  task_serializer: "json"
  result_serializer: "json"
  accept_content: ["json"]
  timezone: "Asia/Seoul"
  enable_utc: true

# 로깅
logging:
  level: "INFO"
  to_console: true
  to_file: true
  format: "[%(asctime)s] %(levelname)s %(message)s"
  datefmt: "%Y-%m-%d %H:%M:%S"

# FFmpeg
ffmpeg:
  binary: "ffmpeg"
  ffprobe: "ffprobe"

# Assets
assets:
  font:
    noto_sans_kr_regular: "assets/fonts/NotoSansKR-Regular.ttf"

# Step 1.5: 프롬프트 증강 설정 ← 추가
prompt_expansion:
  enabled: true
  target_length: 200  # 확장 목표 단어 수
  include_keywords: true
  include_tone: true
  include_target_audience: true
  temperature: 0.8
  max_tokens: 512